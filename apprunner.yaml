version: 1.0
runtime: php82
build:
  commands:
    pre_build:
      - echo "Installing system dependencies"
      - apt-get update
      - apt-get install -y git curl libpng-dev libonig-dev libxml2-dev zip unzip default-mysql-client
      - docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd
    build:
      - echo "Installing Composer dependencies"
      - composer install --optimize-autoloader --no-dev --no-interaction
      - echo "Copying environment file"
      - cp .env.example .env
      - echo "Generating application key"
      - php artisan key:generate --force
      - echo "Caching configuration"
      - php artisan config:cache
      - php artisan route:cache
      - php artisan view:cache
    post_build:
      - echo "Running database migrations"
      - php artisan migrate --force
      - echo "Build completed successfully"
run:
  runtime-version: 8.2.0
  commands:
    web: php artisan serve --host=0.0.0.0 --port=8080
  network:
    port: 8080
    env: PORT
  env:
    APP_ENV: production
    APP_DEBUG: false
    LOG_LEVEL: error
    LOG_CHANNEL: stderr